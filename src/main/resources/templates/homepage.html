<!DOCTYPE html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link th:href="@{/css/manager-user.css}" rel="stylesheet" type="text/css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/flaticon.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/barfiller.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/magnific-popup.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/font-awesome.min.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/elegant-icons.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/nice-select.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/slicknav.min.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/style.css}" type="text/css">
    <link th:href="@{/css/style1.css}" rel="stylesheet" type="text/css">
    <title>Croak Order</title>
    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
    <!-- Libraries Stylesheet -->
    <link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet">
    <!-- Customized Bootstrap Stylesheet -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" type="text/css">
    <!-- Template Stylesheet -->
    <link href="/css/style_test.css" th:href="@{/css/style_test.css}" rel="stylesheet">
    <style>
        .section-divider {
            border: none;
            height: 3px;
            background-color: #0c0202; /* Màu cam nhạt */
            margin: 40px 0; /* Khoảng cách trên và dưới của đường ngang */
        }
        .border-orange {
            border-color: orange !important;
        }
    </style>
</head>
<body>
<div th:replace="header :: header"></div>

<!-- Hero Start -->
<div class="container-fluid py-5 mb-5 hero-header">
    <div class="container py-5">
        <div class="row g-5 align-items-center">
            <div class="col-md-12 col-lg-7">
                <br>
                <h4 class="mb-3 text-secondary">100% Nguyên liệu sạch</h4>
                <h1 class="mb-5 text-primary" style="font-size: 4.5rem;">Bữa ăn tiện lợi <span style="display: block;">Trọn vẹn yêu thương!</span></h1>
                <form id="categoryForm" action="/canteen_details" method="get">
                    <div class="position-relative mx-auto" style="display: flex; justify-content: center; align-items: center;">
                        <input class="form-control border-2 border-secondary py-3 px-4 rounded-pill"
                               name="name" th:value="${name}" placeholder="Nhập từ khóa tìm kiếm..."
                               onkeypress="if(event.keyCode === 13) { event.preventDefault(); document.getElementById('categoryForm').submit(); }"
                               style="flex-grow: 1; margin-right: 10px;">
                        <button type="submit"
                                class="btn btn-primary border-2 border-secondary py-3 px-4 rounded-pill text-white"
                                style="height: 52px; width: 52px; display: flex; justify-content: center; align-items: center;">
                            <i class="fas fa-search"></i> <!-- Nếu muốn có biểu tượng tìm kiếm -->
                        </button>
                    </div>
                </form>
            </div>

            <div class="col-md-12 col-lg-5">
                <div id="carouselId" class="carousel slide position-relative border border-orange rounded" data-bs-ride="carousel">
                    <div class="carousel-inner" role="listbox">
                        <div class="carousel-item active rounded" th:each="food, stat : ${items_home}"
                             th:class="${stat.index == 0} ? 'carousel-item active' : 'carousel-item'">
                            <img th:src="${food.imageFood}" class="img-fluid w-100 h-100 rounded" alt="First slide">
                            <div class="carousel-caption d-none d-md-block">
                                <a th:href="@{/food_details(id=${food.foodId})}"><h5 th:text="${food.foodName}"></h5></a>
                                <!-- <p class="formatted-price" th:text="${food.price}"></p> -->
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselId"
                            data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselId"
                            data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Hero End -->

<hr class="section-divider">

<!-- Categories Section Begin -->
<div class="categories">
    <div class="container">
        <div class="container-fluid fruite py-3">
            <div class="container py-3">
                <div class="tab-class text-center">
                    <div class="row g-3">
                        <div class="col-lg-4 text-start">
                            <h1>Món Ăn</h1>
                        </div>
                        <div class="col-lg-8 text-end">
                            <ul class="nav nav-pills d-inline-flex text-center mb-5">
                                <li class="nav-item">
                                    <a class="d-flex m-2 py-2 bg-light rounded-pill border border-orange active" data-bs-toggle="pill"
                                       href="#tab-1">
                                        <span class="text-dark" style="width: 130px;">Bán chạy</span>
                                    </a>
                                </li>
                                <li class="nav-item1" th:each="category : ${categories}">
                                    <a class="d-flex py-2 m-2 bg-light rounded-pill border border-orange" data-bs-toggle="pill" href="#tab-2"
                                       th:data-category-id="${category.categoryId}">
                                        <span class="text-dark" style="width: 130px;"
                                              th:text="${category.categoryName}"></span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="tab-content">
                        <div id="tab-1" class="tab-pane fade show p-0 active">
                            <div class="row g-4">
                                <div class="col-lg-12">
                                    <div class="row g-4">
                                        <div class="col-md-6 col-lg-4 col-xl-3" th:each="food : ${items_home}">
                                            <div class="rounded position-relative fruite-item border border-orange">
                                                <div class="fruite-img">
                                                    <img th:href="@{/food_details(id=${food.foodId})}" th:src="${food.imageFood}" class="img-fluid w-100 rounded-top" style="height: 220px" alt="">
                                                </div>
                                                <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">
                                                    <span th:text="${food.category.categoryName}"></span>
                                                </div>
                                                <div class="p-4 border border-secondary border-top-0 rounded-bottom">
                                                    <h4><a th:href="@{/food_details(id=${food.foodId})}" th:text="${food.foodName}" style="display: flex; justify-content: left; margin-bottom: 1px; height: 55.41px"></a></h4>
                                                    <p><span th:text="${food.canteen.canteenName}" style="display: flex; justify-content: left"></span></p>
                                                    <p><span th:if="${food.foodQuantity} > 0" th:text="'Số lượng hiện có: ' + ${food.foodQuantity}" style="display: flex; justify-content: left"></span></p>
                                                    <p th:if="${food.foodQuantity} == 0" class="flex-grow-1"><span style="display: flex; justify-content: left; color: red"> Tạm thời hết hàng</span></p>
                                                    <div class="d-flex justify-content-between flex-lg-wrap">
                                                        <span class="text-dark fs-5 fw-bold mb-0"><span class="formatted-price" th:text="${food.price}"></span></span>
                                                        <a th:href="@{/add_to_cart(foodId=${food.foodId}, price=${food.price}, quantity=1, url=1)}" class="btn border border-secondary rounded-pill px-3 text-primary">
                                                            <i class="fa fa-shopping-bag me-2 text-primary"></i>Đặt Món
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="tab-2" class="tab-pane fade show p-0">
                            <div class="row g-4" id="food-container">
                                <!-- Danh sách món ăn sẽ được cập nhật ở đây -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <hr class="section-divider">

        <!-- Banner giảm giá-->
        <div class="container-fluid service py-4">
            <div class="container py-4">
                <div class="row g-4 justify-content-center">
                    <div class="col-md-6 col-lg-4">
                        <a>
                            <div class="service-item bg-secondary rounded border border-secondary">
                                <img src="/img/chococ.png" class="img-fluid rounded-top w-100" alt="">
                                <div class="px-4 rounded-bottom">
                                    <div class="service-content bg-primary text-center p-4 rounded">
                                        <h5 class="text-white">Fresh Apples</h5>
                                        <h3 class="mb-0">20% OFF</h3>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <a>
                            <div class="service-item bg-dark rounded border border-dark">
                                <img src="/img/chococ.png" class="img-fluid rounded-top w-100" alt="">
                                <div class="px-4 rounded-bottom">
                                    <div class="service-content bg-light text-center p-4 rounded">
                                        <h5 class="text-primary">Tasty Fruits</h5>
                                        <h3 class="mb-0">Free delivery</h3>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <a>
                            <div class="service-item bg-primary rounded border border-primary">
                                <img src="/img/chococ.png" class="img-fluid rounded-top w-100" alt="">
                                <div class="px-4 rounded-bottom">
                                    <div class="service-content bg-secondary text-center p-4 rounded">
                                        <h5 class="text-white">Exotic Vegitable</h5>
                                        <h3 class="mb-0">Discount 30$</h3>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Nội dung trang web của bạn -->
<div class="container-fluid vesitable py-5">
    <div class="container py-5">
        <hr class="section-divider">
        <h1 class="mb-0">Có thể bạn sẽ thích</h1>
        <div style="margin-top: 10px"></div>
        <div class="owl-carousel vegetable-carousel justify-content-center">
            <div class="d-flex flex-column border border-orange rounded position-relative" th:each="food : ${items_home}">
                <div class="vesitable-img">
                    <img th:src="${food.imageFood}" class="img-fluid w-100 rounded-top" alt="" style="height: 220px">
                </div>
                <div class="text-white bg-primary px-3 py-1 rounded position-absolute" style="top: 10px; right: 10px;">
                    <span th:text="${food.category.categoryName}">Vegetable</span>
                </div>
                <div class="p-4 rounded-bottom d-flex flex-column flex-grow-1">
                    <h4 class="flex-grow-1" style="height: 55.41px"><a th:href="@{/food_details(id=${food.foodId})}" th:text="${food.foodName}"></a></h4>
                    <p class="flex-grow-1"><span th:text="${food.canteen.canteenName}"></span></p>
                    <p th:if="${food.foodQuantity} > 0" class="flex-grow-1"><span th:text="'Số lượng hiện có: ' + ${food.foodQuantity}" style="display: flex; justify-content: left"></span></p>
                    <p th:if="${food.foodQuantity} == 0" class="flex-grow-1"><span style="display: flex; justify-content: left; color: red"> Tạm thời hết hàng</span></p>
                    <div class="d-flex justify-content-between flex-lg-wrap mt-auto">
                        <p class="text-dark fs-5 fw-bold mb-0"><span class="formatted-price" th:value="${food.price}" th:text="${food.price}"></span></p>
                        <a th:if="${food.foodQuantity} > 0" th:href="@{/add_to_cart(foodId=${food.foodId}, price=${food.price}, quantity=1, url=1)}" class="btn border border-secondary rounded-pill px-3 text-primary">
                            <i class="fa fa-shopping-bag me-2 text-primary"></i>Đặt Món
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Các service -->
    <div class="container-fluid featurs py-3" style="background-color: #cccccc">
        <div class="container py-4">
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="featurs-item text-center rounded bg-light p-4 border border-orange">
                        <div class="featurs-icon btn-square rounded-circle bg-secondary mb-5 mx-auto">
                            <i class="fas fa-car-side fa-3x text-white"></i>
                        </div>
                        <div class="featurs-content text-center">
                            <h5>Croak Order</h5>
                            <p class="mb-0">Miễn Phí Giao Hàng</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="featurs-item text-center rounded bg-light p-4 border border-orange">
                        <div class="featurs-icon btn-square rounded-circle bg-secondary mb-5 mx-auto">
                            <i class="fas fa-user-shield fa-3x text-white"></i>
                        </div>
                        <div class="featurs-content text-center">
                            <h5>Thanh Toán Bảo Mật</h5>
                            <p class="mb-0">100% Bảo Mật Thông Tin</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="featurs-item text-center rounded bg-light p-4 border border-orange">
                        <div class="featurs-icon btn-square rounded-circle bg-secondary mb-5 mx-auto">
                            <i class="fas fa-exchange-alt fa-3x text-white"></i>
                        </div>
                        <div class="featurs-content text-center">
                            <h5>Đặt Hàng</h5>
                            <p class="mb-0">Đặt Hàng Nhanh Chóng</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="featurs-item text-center rounded bg-light p-4 border border-orange">
                        <div class="featurs-icon btn-square rounded-circle bg-secondary mb-5 mx-auto">
                            <i class="fa fa-phone-alt fa-3x text-white"></i>
                        </div>
                        <div class="featurs-content text-center">
                            <h5>Hỗ Trợ</h5>
                            <p class="mb-0">Hỗ Trợ Nhiệt Tình</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="footer :: footer"></div>

<script th:src="@{/js/owl.carousel.min.js}"></script>
<script th:src="@{/js/main.js}"></script>
<script>
    // Function to format currency in VND
    function formatCurrencyVND(amount) {
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(amount);
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.formatted-price').forEach(function (element) {
            let price = element.innerText;
            element.innerText = formatCurrencyVND(price);
        });

        document.querySelectorAll('.nav-item1 a').forEach(item => {
            item.addEventListener('click', function (event) {
                event.preventDefault();
                let categoryId = this.getAttribute('data-category-id');
                console.log("Category ID: " + categoryId); // Ghi lại giá trị của categoryId

                fetch(`/foodByCategory/${categoryId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Data received: ", data); // Ghi lại dữ liệu nhận được từ API

                        let foodContainer = document.getElementById('food-container');
                        foodContainer.innerHTML = '';
                        data.forEach(food => {
                            let foodElement = document.createElement('div');
                            foodElement.classList.add('col-md-6', 'col-lg-4', 'col-xl-3');

                            // Kiểm tra số lượng thực phẩm và điều kiện để hiển thị
                            let quantityInfo = '';
                            let addButton = '';

                            if (food.foodQuantity > 0) {
                                quantityInfo = `<p><span style="display: flex; justify-content: left"> Số lượng hiện có: ${food.foodQuantity}</span></p>`;
                                addButton = `<a href="/add_to_cart?foodId=${food.foodId}&price=${food.price}&quantity=1&url=1" class="btn border border-secondary rounded-pill px-3 text-primary">
                                            <i class="fa fa-shopping-bag me-2 text-primary"></i> Đặt Món
                                        </a>`;
                            } else {
                                quantityInfo = `<p class="flex-grow-1"><span style="display: flex; justify-content: left; color: red">Tạm thời hết hàng</span></p>`;
                            }

                            foodElement.innerHTML = `
                            <div class="rounded position-relative fruite-item border border-orange">
                                <div class="fruite-img">
                                    <img src="${food.imageFood}" class="img-fluid w-100 rounded-top" style="height: 220px" alt="${food.foodName}">
                                </div>
                                <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">
                                    <span>${food.category.categoryName}</span>
                                </div>
                                <div class="p-4 border border-secondary border-top-0 rounded-bottom">
                                    <h4 style="height: 55.41px"><a href="/food_details?id=${food.foodId}" class="text-dark">${food.foodName}</a></h4>
                                    <p><span style="display: flex; justify-content: left">${food.canteen.canteenName}</span></p>
                                    ${quantityInfo}
                                    <div class="d-flex justify-content-between flex-lg-wrap">
                                        <p class="formatted-price text-dark fs-5 fw-bold mb-0">${food.price}</p>
                                        ${addButton}
                                    </div>
                                </div>
                            </div>
                        `;
                            foodContainer.appendChild(foodElement);
                        });

                        document.querySelectorAll('p.formatted-price').forEach(function (element) {
                            let price = element.innerText;
                            element.innerText = formatCurrencyVND(price);
                        });
                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                    });
            });
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        const messageElement = document.getElementById('toast-message');
        const message = messageElement ? messageElement.value : null;

        if (message) {
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.innerText = message;
            document.body.appendChild(toast);

            setTimeout(function () {
                toast.classList.remove('show');
                document.body.removeChild(toast);
            }, 5000);
        }
    });
</script>

<!-- JavaScript Libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/lib/easing/easing.min.js" th:src="@{/lib/easing/easing.min.js}"></script>
<script src="/lib/waypoints/waypoints.min.js" th:src="@{/lib/waypoints/waypoints.min.js}"></script>
<script src="/lib/lightbox/js/lightbox.min.js" th:src="@{/lib/lightbox/js/lightbox.min.js}"></script>
<script src="/lib/owlcarousel/owl.carousel.min.js" th:src="@{/lib/owlcarousel/owl.carousel.min.js}"></script>
<!-- Template Javascript -->
<script src="/js/main_test.js" th:src="@{/js/main_test.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.min.js"></script>
</body>
<input type="hidden" id="toast-message" th:value="${messageAddFood}"/>
</html>
